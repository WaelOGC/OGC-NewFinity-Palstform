flowchart TB

%% Phase 3 - Component Interaction Diagram
%% Interaction between core components

subgraph FRONTEND["Frontend UI Layer"]
  UI_COMPONENTS[UI Components]
  PAGES[Pages]
  STATE_MGMT[State Management]
end

subgraph API_GATEWAY["API Gateway"]
  ROUTING[Request Routing]
  MIDDLEWARE[Middleware Layer]
  RATE_LIMIT[Rate Limiting]
end

subgraph SERVICES["Backend Services"]
  AUTH_SERVICE[Auth Service]
  WALLET_SERVICE[Wallet Service]
  CHALLENGE_SERVICE[Challenge Service]
  BADGES_ENGINE[Badges Engine]
  NOTIFICATION_SERVICE[Notification Service]
end

subgraph DATA_LAYER["Data Layer"]
  PRISMA_ORM[Prisma ORM]
  DATABASE[(Database)]
end

subgraph EXTERNAL["External Services"]
  BLOCKCHAIN[Blockchain Network]
  EMAIL_SERVICE[Email Service]
end

FRONTEND --> API_GATEWAY
UI_COMPONENTS --> PAGES
PAGES --> STATE_MGMT
STATE_MGMT --> API_GATEWAY

API_GATEWAY --> ROUTING
ROUTING --> MIDDLEWARE
MIDDLEWARE --> RATE_LIMIT
RATE_LIMIT --> SERVICES

ROUTING --> AUTH_SERVICE
ROUTING --> WALLET_SERVICE
ROUTING --> CHALLENGE_SERVICE
ROUTING --> BADGES_ENGINE
ROUTING --> NOTIFICATION_SERVICE

AUTH_SERVICE --> PRISMA_ORM
WALLET_SERVICE --> PRISMA_ORM
CHALLENGE_SERVICE --> PRISMA_ORM
BADGES_ENGINE --> PRISMA_ORM
NOTIFICATION_SERVICE --> PRISMA_ORM

PRISMA_ORM --> DATABASE

WALLET_SERVICE --> BLOCKCHAIN
CHALLENGE_SERVICE --> BADGES_ENGINE
BADGES_ENGINE --> NOTIFICATION_SERVICE
NOTIFICATION_SERVICE --> EMAIL_SERVICE

AUTH_SERVICE -.->|Validates Requests| MIDDLEWARE
WALLET_SERVICE -.->|Token Updates| CHALLENGE_SERVICE
CHALLENGE_SERVICE -.->|Triggers| BADGES_ENGINE
BADGES_ENGINE -.->|Notifies| NOTIFICATION_SERVICE

