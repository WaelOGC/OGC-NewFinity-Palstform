flowchart TB

%% Phase 9.8 - Amy AI Agent Data Flow Architecture
%% How data moves through the system

USER([User])

subgraph INPUT_LAYER["Input Layer"]
  USER_INPUT[User Input]
  INPUT_VALIDATION[Input Validation]
  INPUT_SANITIZATION[Input Sanitization]
end

subgraph PRE_PROCESSING["Pre-Processing Layer"]
  CONTEXT_ENRICHMENT[Context Enrichment]
  TOKENIZATION[Tokenization]
  REQUEST_FORMATTING[Request Formatting]
end

subgraph MODEL_EXECUTION["Model Execution Layer"]
  MODEL_SELECTION[Model Selection]
  AI_EXECUTION[AI Model Execution]
  RESPONSE_RAW[Raw Response]
end

subgraph POST_PROCESSING["Post-Processing Layer"]
  RESPONSE_PARSING[Response Parsing]
  CONTENT_FILTERING[Content Filtering]
  FORMATTING[Response Formatting]
  QUALITY_CHECK[Quality Check]
end

subgraph STORAGE_LAYER["Storage Layer"]
  HISTORY_STORE[History Storage]
  SAVED_OUTPUTS[Saved Outputs]
  LOGS_STORE[Logs Storage]
end

subgraph ANALYTICS_LAYER["Analytics Layer"]
  USAGE_TRACKING[Usage Tracking]
  TOOL_PERFORMANCE[Tool Performance Metrics]
  USER_ANALYTICS[User Analytics]
  REPORTING[Reporting]
end

USER --> USER_INPUT
USER_INPUT --> INPUT_LAYER

INPUT_LAYER --> INPUT_VALIDATION
INPUT_VALIDATION --> INPUT_SANITIZATION
INPUT_SANITIZATION --> PRE_PROCESSING

PRE_PROCESSING --> CONTEXT_ENRICHMENT
CONTEXT_ENRICHMENT --> TOKENIZATION
TOKENIZATION --> REQUEST_FORMATTING
REQUEST_FORMATTING --> MODEL_EXECUTION

MODEL_EXECUTION --> MODEL_SELECTION
MODEL_SELECTION --> AI_EXECUTION
AI_EXECUTION --> RESPONSE_RAW
RESPONSE_RAW --> POST_PROCESSING

POST_PROCESSING --> RESPONSE_PARSING
RESPONSE_PARSING --> CONTENT_FILTERING
CONTENT_FILTERING --> FORMATTING
FORMATTING --> QUALITY_CHECK
QUALITY_CHECK --> USER

QUALITY_CHECK --> STORAGE_LAYER
STORAGE_LAYER --> HISTORY_STORE
STORAGE_LAYER --> SAVED_OUTPUTS
STORAGE_LAYER --> LOGS_STORE

STORAGE_LAYER --> ANALYTICS_LAYER
ANALYTICS_LAYER --> USAGE_TRACKING
ANALYTICS_LAYER --> TOOL_PERFORMANCE
ANALYTICS_LAYER --> USER_ANALYTICS
ANALYTICS_LAYER --> REPORTING

HISTORY_STORE --> USER
SAVED_OUTPUTS --> USER

